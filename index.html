<!DOCTYPE html>
<html>
<head>
  <title>Firebase Login + Razorpay Payment</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
  <h2>Login</h2>
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>

  <h2>OR Register</h2>
  <input type="email" id="regEmail" placeholder="Email"><br>
  <input type="password" id="regPassword" placeholder="Password"><br>
  <button onclick="register()">Register</button>

  <h2>Payment Section</h2>
  <button onclick="startPayment()">Pay ‚Çπ1</button>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDo-0Cd5fFOl4aIM6kloK_qLSRr2hQOrhA",
      authDomain: "rs-cit-cf751.firebaseapp.com",
      databaseURL: "https://rs-cit-cf751-default-rtdb.firebaseio.com",
      projectId: "rs-cit-cf751",
      storageBucket: "rs-cit-cf751.appspot.com",
      messagingSenderId: "180386684605",
      appId: "1:180386684605:web:9968bb8b1ca557bdbca1d4"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    // üîê User Login
    function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
          alert("Login successful!");
        })
        .catch(error => {
          alert(error.message);
        });
    }

    // üìù User Registration
    function register() {
      const email = document.getElementById('regEmail').value;
      const password = document.getElementById('regPassword').value;

      auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          alert("Registered successfully!");
        })
        .catch(error => {
          alert(error.message);
        });
    }

    // üí∞ Start Razorpay Payment
    async function startPayment() {
      const user = auth.currentUser;
      if (!user) {
        alert("Please login first.");
        return;
      }

      // üîÅ Call your backend API to get order_id
      const response = await fetch('http://localhost:3000/create-order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          amount: 100,
          currency: 'INR',
          receipt: 'order_rcptid_' + Date.now()
        })
      });

      const orderData = await response.json();
      console.log(orderData)
      if (orderData.error) {
        alert("Error: " + orderData.error);
        return;
      }
      const options = {
        key: "rzp_test_BXuuEKVm5vUBlx",
        amount: orderData.amount,
        currency: orderData.currency,
        name: "RS-CIT User",
        description: "Payment for Online Test",
        order_id: orderData.id,
        handler: function (response) {
          database.ref("payments/" + user.uid).push({
            email: user.email,
            payment_id: response.razorpay_payment_id,
            order_id: response.razorpay_order_id,
            signature: response.razorpay_signature,
            status: "paid",
            time: new Date().toISOString()
          });
          alert("Payment Successful!");
        },
        prefill: {
          name: user.email,
          email: user.email
        },
        theme: {
          color: "#0f9d58"
        }
      };

      const rzp = new Razorpay(options);
      rzp.open();
    }
  </script>
</body>
</html>